machine:
  services:
    - redis
dependencies:
  cache_directories:
    - ~/.asdf
  pre:
    - if [[ ! -e ~/.asdf ]]; then git clone https://github.com/HashNuke/asdf.git ~/.asdf; fi
    - source $HOME/.asdf/asdf.sh && asdf plugin-add erlang https://github.com/HashNuke/asdf-erlang.git
    - source $HOME/.asdf/asdf.sh && asdf plugin-add elixir https://github.com/HashNuke/asdf-elixir.git
    - source $HOME/.asdf/asdf.sh && asdf install erlang 17.5
    - source $HOME/.asdf/asdf.sh && asdf install elixir 1.0.4
    - source $HOME/.asdf/asdf.sh && yes | mix deps.get
    - source $HOME/.asdf/asdf.sh && mix local.rebar
test:
  override:
    - source $HOME/.asdf/asdf.sh && mix test
  post:
    - source $HOME/.asdf/asdf.sh && mix coveralls.post
